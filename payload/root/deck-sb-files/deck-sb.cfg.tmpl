# auto-generated by Deck SB ISO
insmod all_video
insmod gfxterm
set gfxmode=1280x800,800x1280,auto
set gfxpayload=keep
if loadfont /boot/grub/unicode.pf2 || \
   loadfont unicode; then
    set gfxterm_font=unicode
    terminal_output gfxterm
else
    terminal_output console
fi
set menu_color_normal=cyan/black
set menu_color_highlight=black/cyan
set pager=1
set color_normal=cyan/black
set color_highlight=black/cyan
set color_special=light-cyan/black
set color_title=cyan/black
set color_border=cyan/black

if [ -n "$grub_platform" ] && [ "$terminal_output" = "gfxterm" ]; then
    echo 'Deck Secure Boot GRUB ready.'
fi

set menu_label='Deck Secure Boot Loader'

menuentry 'SteamOS SB (shimless)' {
    insmod part_gpt
    insmod btrfs
    insmod gzio
__DECK_SB_KERNEL_BLOCK__
}

# Automatically detect Windows, Clover, and the stock SteamOS loader when present
set deck_win_path=''
if search --file /EFI/Microsoft/Boot/bootmgfw.efi --set=deck_win; then
    set deck_win_path='/EFI/Microsoft/Boot/bootmgfw.efi'
elif search --file /EFI/Microsoft/bootmgfw.efi --set=deck_win; then
    set deck_win_path='/EFI/Microsoft/bootmgfw.efi'
fi

if test -n "$deck_win_path"; then
    menuentry 'Windows Boot Manager' {
        insmod part_gpt
        insmod fat
        insmod chain
        search --no-floppy --file $deck_win_path --set=root
        echo 'Tip: Boot Windows directly from the BIOS menu (Vol- + Power) to avoid Secure Boot prompts.'
        echo 'If you are using Clover, Use (Vol+ + Power), Boot From File, efi/Microsoft/bootmgrw.efi'
        sleep 2
        chainloader $deck_win_path
    }
fi

set deck_clover_path=''
if search --file /EFI/CLOVER/CLOVERX64.efi --set=deck_clover; then
    set deck_clover_path='/EFI/CLOVER/CLOVERX64.efi'
elif search --file /EFI/Clover/CLOVERX64.efi --set=deck_clover; then
    set deck_clover_path='/EFI/Clover/CLOVERX64.efi'
elif search --file /efi/clover/CLOVERX64.efi --set=deck_clover; then
    set deck_clover_path='/efi/clover/CLOVERX64.efi'
elif search --file /EFI/CLOVER/cloverx64.efi --set=deck_clover; then
    set deck_clover_path='/EFI/CLOVER/cloverx64.efi'
elif search --file /EFI/Clover/cloverx64.efi --set=deck_clover; then
    set deck_clover_path='/EFI/Clover/cloverx64.efi'
elif search --file /efi/clover/cloverx64.efi --set=deck_clover; then
    set deck_clover_path='/efi/clover/cloverx64.efi'
fi

if test -n "$deck_clover_path"; then
    menuentry 'Clover Bootloader' {
        insmod part_gpt
        insmod fat
        insmod chain
        search --no-floppy --file $deck_clover_path --set=root
        chainloader $deck_clover_path
    }
fi

set deck_steamcl_path=''
if search --file /EFI/steamos/steamcl.efi --set=deck_steamcl; then
    set deck_steamcl_path='/EFI/steamos/steamcl.efi'
elif search --file /efi/steamos/steamcl.efi --set=deck_steamcl; then
    set deck_steamcl_path='/efi/steamos/steamcl.efi'
fi

if test -n "$deck_steamcl_path"; then
    menuentry 'SteamOS Official Bootloader' {
        insmod part_gpt
        insmod fat
        insmod chain
        search --no-floppy --file $deck_steamcl_path --set=root
        chainloader $deck_steamcl_path
    }
fi
